#pragma once

#include "Optional.hpp"
#include "../Exception.hpp"

template <class T>

class DynamicArray {
private:
    Optional<T>* items;
    int size;

public:
    DynamicArray(const T* items, const int size) {
        if (size < 1) {
            throw new Exception;
        }

        this->items = static_cast<Optional<T>*>(operator new [](size * sizeof(Optional<T>)));
        this->size = size;

        for (int i = 0; i < size; i++) {
            this->items[i] = items[i];
        }
    }

    DynamicArray(const int size) {
        if (size < 1) {
            throw new Exception;
        }

        this->items = static_cast<Optional<T>*>(operator new[](size * sizeof(Optional<T>)));
        this->size = size;

        for (int i = 0; i < size; i++) {
            this->items[i] = *Optional<T>::Empty();
        }
    }

    DynamicArray(const DynamicArray<T> &array) {
        this->items = static_cast<Optional<T>*>(operator new[](size * sizeof(Optional<T>)));
        this->size = array.Size();

        for (int i = 0; i < size; i++) {
            this->items[i] = array.Get(i);
        }
    }

public:
    int Size() const { return this->size; }

    T Get(const int index) const {
        if (index < 0 ||
            index >= this->Size() ||
            !this->items[index].HasValue()) {
            throw new Exception;
        }

        return this->items[index].GetValue();
    }

public:
    void Set(int index, T value) {
        if (index < 0 || index >= this->Size()) {
            throw new Exception;
        }

        this->items[index] = value;
    }

    void Resize(int newSize) {
        if (newSize < 1) {
            throw new Exception;
        }

        if (newSize == this->Size()) {
            return;
        }

        std::cout << "before static cast" << std::endl;
        Optional<T>* newArr = static_cast<Optional<T>*>(operator new[](newSize * sizeof(Optional<T>)));
        std::cout << "after static cast " << this->Size() << " " << newSize << std::endl;

        if (newSize < this->Size()) {
            for (int i = 0; i < newSize; i++) {
                newArr[i] = this->items[i];
            }
        } else {
            int i = 0;

            std::cout << "in copy " << this->Size() << " " << newSize << std::endl;
            for (; i < this->Size(); i++) {
                newArr[i] = this->items[i];
            }

            std::cout << "after first loop " << i << std::endl;

            std::cout << i << newSize<< std::endl;
            for (; i < newSize; i++) {
                std::cout << i << " ";
                newArr[i] = *Optional<T>::Empty();
            }

            std::cout << std::endl << "after second loop " << this->Size() << " " << newSize << std::endl;
        }

        this->size = newSize;
        this->items = newArr;
    }
};

